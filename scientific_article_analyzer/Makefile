# Scientific Article Analyzer - Makefile
# Comandos para setup e execuÃ§Ã£o do sistema

.PHONY: setup index mcp agent test clean help

# ConfiguraÃ§Ã£o inicial do ambiente
setup:
	@echo "ğŸ”§ Configurando ambiente..."
	pip install -r requirements_minimal.txt
	@mkdir -p out
	@mkdir -p vector_store
	@echo "âœ… Ambiente configurado com sucesso!"

# ConstrÃ³i e popula o vector store com 9 artigos
index:
	@echo "ğŸ“š Construindo vector store com 9 artigos..."
	jupyter nbconvert --execute --to notebook --ExecutePreprocessor.timeout=600 setup_vector_store.ipynb
	@echo "âœ… Vector store populado com sucesso!"

# Sobe o servidor MCP em background
mcp:
	@echo "ğŸ–¥ï¸ Iniciando servidor MCP..."
	@python mcp_server.py &
	@echo "âœ… Servidor MCP iniciado em background (PID: $$!)"
	@sleep 2

# Inicia o agente multi-agÃªntico
agent:
	@echo "ğŸ¤– Iniciando sistema multi-agÃªntico..."
	python agent_system.py
	@echo "âœ… Sistema de agentes executado!"

# Executa testes completos
test: test1 test2 test3

# Teste 1: Classificar e extrair samples/input_article_1.md
test1:
	@echo "ğŸ§ª TESTE 1: ClassificaÃ§Ã£o e extraÃ§Ã£o do artigo de exemplo"
	@echo "=================================================="
	python run_test.py --input samples/input_article_1.md --output out/extraction_1.json --review out/review_1.md
	@echo "âœ… Teste 1 concluÃ­do!"

# Teste 2: Artigo via URL (simulado com texto)
test2:
	@echo "ğŸ§ª TESTE 2: Processamento de artigo via URL"
	@echo "==========================================="
	python run_test.py --url "https://example.com/article" --output out/extraction_2.json --review out/review_2.md
	@echo "âœ… Teste 2 concluÃ­do!"

# Teste 3: Edge case - artigo fora das 3 Ã¡reas
test3:
	@echo "ğŸ§ª TESTE 3: Edge case - artigo fora das Ã¡reas conhecidas"
	@echo "======================================================="
	python run_test.py --edge-case --output out/extraction_3.json --review out/review_3.md
	@echo "âœ… Teste 3 concluÃ­do!"

# Limpa arquivos temporÃ¡rios e outputs
clean:
	@echo "ğŸ§¹ Limpando arquivos temporÃ¡rios..."
	@rm -rf out/*.json out/*.md
	@rm -rf __pycache__/ *.pyc
	@echo "âœ… Limpeza concluÃ­da!"

# Mostra comandos disponÃ­veis
help:
	@echo "ğŸ”¬ Scientific Article Analyzer - Comandos DisponÃ­veis"
	@echo "====================================================="
	@echo ""
	@echo "Setup e ConfiguraÃ§Ã£o:"
	@echo "  make setup    - Configura ambiente e dependÃªncias"
	@echo "  make index    - ConstrÃ³i e popula vector store (9 artigos)"
	@echo ""
	@echo "ExecuÃ§Ã£o:"
	@echo "  make mcp      - Inicia servidor MCP em background"
	@echo "  make agent    - Executa sistema multi-agÃªntico"
	@echo ""
	@echo "Testes:"
	@echo "  make test     - Executa todos os testes (1, 2 e 3)"
	@echo "  make test1    - Teste 1: samples/input_article_1.md"
	@echo "  make test2    - Teste 2: artigo via URL"
	@echo "  make test3    - Teste 3: edge case (Ã¡rea nÃ£o coberta)"
	@echo ""
	@echo "UtilitÃ¡rios:"
	@echo "  make clean    - Remove arquivos temporÃ¡rios"
	@echo "  make help     - Mostra esta ajuda"

# Pipeline completo: setup -> index -> mcp -> testes
all: setup index mcp test
	@echo "ğŸ‰ Pipeline completo executado com sucesso!"